<!-- Filters and search -->
<form method="get" action=".">
    <label for="query_name">Search by name:</label>
    <input type="text" name="query_name" id="query_name" value="{{ request.GET.query_name }}">

    <label for="query_ingredients">Search by ingredients:</label>
   
    <select name="query_ingredients" id="query_ingredients" multiple>
        {% for ingredient in all_ingredients %}
            <option value="{{ ingredient.id }}"
                {% if ingredient.id|stringformat:"s" in query_ingredients %}selected{% endif %}>
                {{ ingredient.name }}
            </option>
        {% endfor %}
    </select>


    <label for="cooking_time">Cooking Time:</label>
    <select name="cooking_time" id="cooking_time">
        <option value="">All Cooking Times</option>
        <option value="quick" {% if request.GET.cooking_time == 'quick' %}selected{% endif %}>
            Quick meals (under 20 mins)
        </option>
        <option value="standard" {% if request.GET.cooking_time == 'standard' %}selected{% endif %}>
            Standard meals (20â€“45 mins)
        </option>
        <option value="long" {% if request.GET.cooking_time == 'long' %}selected{% endif %}>
            Long recipes (over 45 mins)
        </option>
    </select>

    <label for="exclude_ingredients">Exclude Ingredients: (Hold down the Ctrl (windows) or Command (Mac) button to select multiple options.)</label>

    <select name="exclude_ingredients" id="exclude_ingredients" multiple>
        {% for ingredient in all_ingredients %}
            <option value="{{ ingredient.id }}"
                {% if ingredient.id|stringformat:"s" in exclude_ingredients %}selected{% endif %}>
                {{ ingredient.name }}
            </option>
        {% endfor %}
    </select>


    <button type="submit">Search</button> 
    <a href="." style="margin-left: 10px;">Reset</a>
</form>

<!-- Results -->
<h1>Recipes</h1>

{% for recipe in recipes %}
    <a href="{% url 'recipe_detail' recipe.id %}"><h2>{{ recipe.name }}</h2></a>
    <p>Ingredients:</p>
    <ul>
        {% for ingredient in recipe.ingredients.all %}
        <li>{{ ingredient.name }}</li>
        {% endfor %}
      </ul> 
    <p>Cooking time: {{ recipe.cooking_time }}</p>
    <ul>
        <li><strong>You have:</strong> {{ recipe.matching_ingredient_names|join:", " }}</li>
        <li><strong>You're missing following  ingredients:</strong> {{ recipe.missing_ingredient_names|join:", " }}</li>
    </ul>
{% endfor %}

<!-- Pagination controls -->
<div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
</div>